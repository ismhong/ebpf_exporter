programs:
  # Like bio, but with tracepoints. It may catch more than just bio, especially
  # if you have RAID, because requests are getting split and remapped.
  #
  # See:
  # * https://github.com/iovisor/bcc/issues/826
  - name: bio
    metrics:
      histograms:
        - name: bio_latency_seconds
          help: Block IO latency histogram
          table: io_latency
          bucket_type: exp2
          bucket_min: 0
          bucket_max: 26
          bucket_multiplier: 0.000001 # microseconds to seconds
          labels:
            - name: device
              size: 4
              decoders:
                - name: majorminor
            - name: operation
              size: 4
              decoders:
                - name: uint
                - name: static_map
                  static_map:
                    1: read
                    2: write
            - name: bucket
              size: 8
              decoders:
                - name: uint
        - name: bio_size_bytes
          help: Block IO size histogram with kibibyte buckets
          table: io_size
          bucket_type: exp2
          bucket_min: 0
          bucket_max: 15
          bucket_multiplier: 1024 # kibibytes to bytes
          labels:
            - name: device
              size: 4
              decoders:
                - name: majorminor
            - name: operation
              size: 4
              decoders:
                - name: uint
                - name: static_map
                  static_map:
                    1: read
                    2: write
            - name: bucket
              size: 8
              decoders:
                - name: uint
    tracepoints:
      block:block_rq_issue: tracepoint/block/block_rq_issue
      block:block_rq_complete: tracepoint/block/block_rq_complete
    elf: bio-tracepoints.elf
